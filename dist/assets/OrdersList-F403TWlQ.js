import{d as z,z as A,G as u,K as J,M as ee,H as te,u as ae,p as re,N as ne,O as oe,P as le,h as S,b as a,Q as se,g as i,w as n,F as k,j as ie,R as ue,f as h,i as m,S as de,T as pe,t as s,U as ce,m as ge,e as me,V as _e,W as fe,X as ye,Y as ve,Z as be,o as x,a as we,_ as $e}from"./index-DH73XLWJ.js";import{g as he}from"./lists-KCPbEXSv.js";/* empty css                  *//* empty css                */import{u as xe}from"./params-G3hHmdaD.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./user-DvChFS7E.js";const Se={style:{"margin-left":"10px"}},ke={class:"flex justify-center mt-4"},Ce=z({name:"OrdersList"}),Te=z({...Ce,setup(Pe){const M=xe(),{savedParams:B}=A(M),d=J(),C=re(),T=ae(),P=u(null);u(null),u(null);const p=u("unassigned"),b=u([]),_=u(1),w=u(100),I=u(0),E=u(null),O=u(null),D=r=>r.order_id,R=async()=>{if(T.path==="/orders")try{const r=await he(p.value,_.value,w.value);b.value=r.results,I.value=r.count}catch{b.value=[],d.proxy.$message({type:"error",message:"获取订单数据失败"})}};let y;const V=d.proxy.debounce(()=>{clearInterval(y),y=setInterval(()=>{!O.value&&!E.value&&R()},3e3)},3e3),v=()=>{!O.value&&!E.value&&(clearInterval(y),R().then(()=>{V(1e3)}).catch(()=>{y=setInterval(v,3e3)}))},K=r=>{_.value=r,v()},L=r=>{w.value=r,v()},N=u(["unassigned","assigned"]),F=r=>{switch(r){case"unassigned":return"未分配订单";case"assigned":return"已分配订单";default:return r}};ee(p,()=>{C.push({query:{type:p.value}}),_.value=1,I.value=0,b.value=[],v()}),te(()=>{const r=T.query.type;r?p.value=r:(p.value="unassigned",C.push({query:{type:p.value}})),v()});const j=()=>{const r=new Date;return`O-${`${r.getFullYear()}${String(r.getMonth()+1).padStart(2,"0")}${String(r.getDate()).padStart(2,"0")}`}-1${String(Math.floor(Math.random()*1e4)+1).padStart(5,"0")}`},U=()=>`R-1${String(Math.floor(Math.random()*1e5)+1).padStart(5,"0")}`,q=()=>`S-${String(Math.floor(Math.random()*50)+1).padStart(3,"0")}`,$=r=>{let t="",c="",g="";const l=j(),o=U(),f=q();switch(r){case"insert":t="是否进行作业插入",c=`正在进行作业插入，已生成优先度为紧急的订单，订单编号${l}`,g=`订单${l}已经被成功分配并优先处理，对应拣选站为${f}，机器人为${o}`;break;case"stuck":t="是否进行作业故障",c=`正在进行作业故障，订单${l}的执行机器人${o}出现故障`,g=`订单${l}已经被成功二次分配，对应拣选站为${f}，机器人为${U()}`;break;case"modify":t="是否进行作业修改",c=`正在进行作业修改，订单${l}的内容SKU种类已经改变`,g=`订单${l}已经被成功二次分配，增加机器人${o}来完成订单`;break;case"cancel":t="是否进行作业取消",c=`正在进行作业取消，将取消订单${l}的执行`,g=`订单${l}已经被成功取消，执行该订单的机器人${o}和拣选站${f}，对应时段已经被释放`;break}d.proxy.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.proxy.$message({type:"info",message:c,duration:2e3}),setTimeout(()=>{d.proxy.$message({type:"success",message:g,duration:4e3})},3e3)}).catch(()=>{d.proxy.$message({type:"info",message:"已取消紧急插单"})})};return ne(()=>{clearInterval(y)}),oe(()=>{le(()=>{P.value.doLayout()})}),(r,t)=>{const c=$e,g=ue,l=de,o=pe,f=ce,Y=me("Timer"),G=ge,H=_e,Q=ye,W=fe,X=ve,Z=be;return x(),S(k,null,[a(g,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e)},{default:n(()=>[(x(!0),S(k,null,ie(N.value,e=>(x(),we(c,{label:F(e),name:e},null,8,["label","name"]))),256))]),_:1},8,["modelValue"]),h(B).扰动类型==="有"?(x(),S(k,{key:0},[a(l,{type:"primary",onClick:t[1]||(t[1]=e=>$("insert"))},{default:n(()=>t[6]||(t[6]=[m("作业插入")])),_:1}),a(l,{type:"danger",onClick:t[2]||(t[2]=e=>$("stuck"))},{default:n(()=>t[7]||(t[7]=[m("作业故障")])),_:1}),a(l,{type:"warning",onClick:t[3]||(t[3]=e=>$("modify"))},{default:n(()=>t[8]||(t[8]=[m("作业修改")])),_:1}),a(l,{type:"infoinfo",onClick:t[4]||(t[4]=e=>$("cancel"))},{default:n(()=>t[9]||(t[9]=[m("作业取消")])),_:1})],64)):se("",!0),a(X,{ref_key:"tableRef",ref:P,data:b.value,"row-key":D,"max-height":"800",style:{width:"90%","margin-top":"100px",margin:"auto"},"scrollbar-always-on":"","header-align":"center",stripe:""},{default:n(()=>[a(o,{type:"index",prop:"index",label:"序号",width:"50",align:"center","header-align":"center"},{default:n(e=>[i("p",null,s(e.$index+1+w.value*(_.value-1)),1)]),_:1}),a(o,{prop:"order_id",width:"250",label:"订单ID",align:"center"}),a(o,{prop:"priority",width:"50",label:"优先级",align:"center"},{default:n(e=>[a(f,{type:h(d).proxy.getTagType(e.row.priority,"order_priority")},{default:n(()=>[m(s(e.row.priority),1)]),_:2},1032,["type"])]),_:1}),a(o,{prop:"status",width:"100",label:"订单状态",align:"center"},{default:n(e=>[a(f,{type:h(d).proxy.getTagType(e.row.status,"order_status")},{default:n(()=>[m(s(e.row.status),1)]),_:2},1032,["type"])]),_:1}),a(o,{prop:"batch_id",width:"50",label:"批次",align:"center"}),a(o,{prop:"timestamp",label:"创建时间",align:"center"},{default:n(e=>[a(G,null,{default:n(()=>[a(Y)]),_:1}),i("span",Se,s(e.row.timestamp),1)]),_:1}),a(o,{prop:"robot_id",width:"90",label:"机器人",align:"center"},{default:n(e=>[i("p",null,s(e.row.robot_id??"未分配"),1)]),_:1}),a(o,{prop:"station_id",width:"90",label:"所在站台",align:"center"},{default:n(e=>[i("p",null,s(e.row.station_id??"未分配"),1)]),_:1}),a(o,{prop:"SKU_detail",width:"150",label:"SKU详情",align:"center"}),a(o,{prop:"order_process",width:"150",label:"进度",align:"center"},{default:n(e=>[a(H,{percentage:parseInt(e.row.order_process.replace("%","")),"text-inside":!0,"stroke-width":22,color:h(d).proxy.getProgressColor(parseInt(e.row.order_process.replace("%","")))},null,8,["percentage","color"])]),_:1}),a(o,{label:"详情",align:"center",width:"150",fixed:"right"},{default:n(e=>[a(W,{trigger:"hover",placement:"top",width:"240px"},{reference:n(()=>[a(Q,{type:"primary",size:"default"},{default:n(()=>t[10]||(t[10]=[m("查看详情")])),_:1})]),default:n(()=>[i("p",null,"订单ID: "+s(e.row.order_id),1),i("p",null,"优先级: "+s(e.row.priority),1),i("p",null,"订单状态: "+s(e.row.status),1),i("p",null,"批次: "+s(e.row.batch_id),1),i("p",null,"SKU详情: "+s(e.row.SKU_detail),1),i("p",null,"创建时间: "+s(e.row.timestamp),1),i("p",null,"进度: "+s(e.row.order_process),1)]),_:2},1024)]),_:1})]),_:1},8,["data"]),i("div",ke,[a(Z,{align:"center",background:"",onCurrentChange:K,onSizeChange:L,"current-page":_.value,"onUpdate:currentPage":t[5]||(t[5]=e=>_.value=e),"page-size":w.value,"page-sizes":[50,100],"pager-count":15,layout:"total, sizes, prev, pager, next, jumper",total:I.value},null,8,["current-page","page-size","total"])])],64)}}}),De=Ie(Te,[["__scopeId","data-v-8cd22acb"]]);export{De as default};
